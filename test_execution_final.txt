
[0;34m======================================================================
  E-Invoice Complete Test Suite - Starting at: Sun Dec 28 20:30:05 CST 2025
======================================================================[0m


[0;34m[1/6] Checking Docker environment...[0m
[0;32m‚úì Docker is running[0m

[0;34m[2/6] Starting Odoo containers...[0m
time="2025-12-28T20:30:05-06:00" level=warning msg="/Users/javycarrillo/Library/CloudStorage/Dropbox/AI/Apps/GMS/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Container gms_postgres  Running
 Container gms_odoo  Running
[0;32m‚úì Containers started successfully[0m

Running containers:
NAMES          STATUS              PORTS
gms_odoo       Up About a minute   0.0.0.0:8070->8069/tcp, [::]:8070->8069/tcp
gms_postgres   Up 10 minutes       0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp

[1;33m‚ö† Waiting 60 seconds for Odoo to fully start...[0m
Time remaining: 60sTime remaining: 50sTime remaining: 40sTime remaining: 30sTime remaining: 20sTime remaining: 10s

[0;34m[3/6] Verifying Odoo accessibility...[0m
[0;32m‚úì Odoo is accessible at http://localhost:8070[0m


[0;34m======================================================================
  [4/6] Phase 1: XML Generation Tests
======================================================================[0m

================================================================================
üß™ Testing Phase 1: E-Invoice XML Generation
================================================================================

üì° Connecting to Odoo...
‚úÖ Connected as user ID: 2

üîç Checking module installation...
‚ö†Ô∏è  Module l10n_cr_einvoice not installed
   Run: ./odoo-bin -d gms_validation -u l10n_cr_einvoice
[0;32m‚úì Phase 1 tests completed[0m
[0;32m‚úì Generated        1 XML file(s)[0m


[0;34m======================================================================
  [5/6] Phase 2: Digital Signature Tests
======================================================================[0m

[0;32m‚úì Certificate found at /Users/javycarrillo/Library/CloudStorage/Dropbox/AI/Apps/GMS/docs/Tribu-CR/certificado.p12[0m

================================================================================
  Phase 2 E-Invoice Digital Signature Testing
================================================================================

This script tests the following components:
  ‚Ä¢ Certificate Manager (certificate_manager.py)
  ‚Ä¢ XML Signer (xml_signer.py)
  ‚Ä¢ Digital Signature Workflow
  ‚Ä¢ XMLDSig Structure Validation

--------------------------------------------------------------------------------
  Test 1: Certificate File Verification
--------------------------------------------------------------------------------

‚úÖ PASS: Certificate file exists
    Found at /Users/javycarrillo/Library/CloudStorage/Dropbox/AI/Apps/GMS/docs/Tribu-CR/certificado.p12 (6,852 bytes)

--------------------------------------------------------------------------------
  Odoo Connection
--------------------------------------------------------------------------------

Connecting to Odoo...
Authenticating as admin...
‚úÖ Authenticated successfully (UID: 2)

--------------------------------------------------------------------------------
  Test 2: Certificate Upload to Company
--------------------------------------------------------------------------------

‚úÖ PASS: Upload certificate to company
    Certificate uploaded to company ID 1

--------------------------------------------------------------------------------
  Test 3: Certificate Loading (.p12)
--------------------------------------------------------------------------------

‚ùå FAIL: Load certificate from .p12
    Error: 'int' object has no attribute 'l10n_cr_certificate'

--------------------------------------------------------------------------------
  Test 5: Error Handling - Wrong PIN
--------------------------------------------------------------------------------

‚úÖ PASS: Wrong PIN error handling
    Correctly rejected wrong PIN

--------------------------------------------------------------------------------
  Test 10: Complete Workflow Integration
--------------------------------------------------------------------------------


--------------------------------------------------------------------------------
  Test 6: Create Test Invoice for Signing
--------------------------------------------------------------------------------

‚úÖ PASS: Create test invoice and e-invoice
    Invoice INV/2025/00021, E-Invoice ID 12

--------------------------------------------------------------------------------
  Test 7: XML Generation (Pre-Signing)
--------------------------------------------------------------------------------

‚úÖ PASS: Generate unsigned XML
    Generated 2,255 bytes

--------------------------------------------------------------------------------
  Test 8: XML Digital Signature
--------------------------------------------------------------------------------

‚ùå FAIL: Sign XML with certificate
    Error: <Fault 2: 'Error signing XML: Company certificate and private key must be configured.'>
‚ùå FAIL: Complete workflow - XML signing
    Signing failed

================================================================================
  Phase 2 Test Summary
================================================================================

Total Tests:  8
Passed:       5 ‚úÖ
Failed:       3 ‚ùå
Pass Rate:    62.5%

--------------------------------------------------------------------------------
Detailed Results:
--------------------------------------------------------------------------------

‚úÖ Certificate file exists
    Found at /Users/javycarrillo/Library/CloudStorage/Dropbox/AI/Apps/GMS/docs/Tribu-CR/certificado.p12 (6,852 bytes)
‚úÖ Upload certificate to company
    Certificate uploaded to company ID 1
‚ùå Load certificate from .p12
    Error: 'int' object has no attribute 'l10n_cr_certificate'
‚úÖ Wrong PIN error handling
    Correctly rejected wrong PIN
‚úÖ Create test invoice and e-invoice
    Invoice INV/2025/00021, E-Invoice ID 12
‚úÖ Generate unsigned XML
    Generated 2,255 bytes
‚ùå Sign XML with certificate
    Error: <Fault 2: 'Error signing XML: Company certificate and private key must be configured.'>
‚ùå Complete workflow - XML signing
    Signing failed

================================================================================

‚ùå ATTENTION NEEDED! Multiple tests failed. Review implementation.

================================================================================

Results saved to: phase2_signature_test_results_20251228_203107.json
================================================================================


Next Steps:
1. Review generated signed_xml_*.xml files
2. Verify signature structure matches Hacienda requirements
3. Ready to start Phase 3: Hacienda API Integration

================================================================================

[0;32m‚úì Phase 2 tests completed[0m
[0;32m‚úì JSON results file generated[0m


[0;34m======================================================================
  [6/6] Phase 3: Hacienda API Integration Tests
======================================================================[0m


================================================================================
  Phase 3 E-Invoice API Integration Testing
================================================================================

Connecting to Odoo...
Authenticating as admin...
‚úÖ Authenticated successfully (UID: 2)

--------------------------------------------------------------------------------
  Test 1: API Connection and Authentication
--------------------------------------------------------------------------------

Environment: N/A
URL: N/A
‚ùå Connection failed: HTTP 403

--------------------------------------------------------------------------------
  Test 2: Find Existing E-Invoice Documents
--------------------------------------------------------------------------------

‚ùå No signed documents found to test

To test Phase 3, you need to:
1. Create an invoice
2. Generate XML (Phase 1)
3. Sign XML (Phase 2)
4. Then run this test to submit to Hacienda (Phase 3)

--------------------------------------------------------------------------------
  Test 5: API Helper Methods
--------------------------------------------------------------------------------

Testing identification type detection:
  C√©dula F√≠sica (9 digits): Type 01
  C√©dula Jur√≠dica (10 digits): Type 02
  DIMEX (11 digits): Type 03
  Empty/Extranjero: Type 05
‚úÖ ID type detection working

--------------------------------------------------------------------------------
  Test Summary
--------------------------------------------------------------------------------


Phase 3 API Integration Features:
‚úì Connection testing with credential validation
‚úì Submit invoice to Hacienda with retry logic
‚úì Check document status
‚úì Exponential backoff retry (max 3 attempts)
‚úì Comprehensive error handling
‚úì Response parsing with base64 decoding
‚úì Status detection helpers (is_accepted, is_rejected, is_processing)
‚úì Authentication error handling
‚úì Rate limiting handling
‚úì Network error handling

Next Steps:
- Test with real invoice submission
- Monitor retry behavior during network issues
- Test rate limiting scenarios
- Validate acceptance/rejection workflows

[0;32m‚úì Phase 3 tests completed[0m


[0;34m======================================================================
  Test Suite Completion Summary - Sun Dec 28 20:31:07 CST 2025
======================================================================[0m


Generated Files:
----------------
  phase1_test_output.txt (406B)
  phase2_signature_test_results_20251228_202513.json (1.2K)
  phase2_signature_test_results_20251228_203107.json (1.2K)
  phase2_test_output.txt (4.7K)
  phase3_test_output.txt (2.1K)
  test_einvoice_10.xml (1.6K)

Test Output Files:
------------------
  Phase 1 Results: phase1_test_output.txt
  Phase 2 Results: phase2_test_output.txt
  Phase 3 Results: phase3_test_output.txt

Quick Results Summary:
----------------------
  Phase 1: [0;31mFAIL[0m - Check phase1_test_output.txt
  Phase 2: [0;31mFAIL[0m - Pass Rate: 62.5%
  Phase 3: [0;32mCONNECTED[0m - API Integration functional

Recommended Actions:
--------------------
  1. Review all three test output files
  2. Inspect generated XML files for correctness
  3. Verify signed XML contains valid XMLDSig signature
  4. Check Phase 2 JSON results for detailed test breakdown
  5. Address any failed tests before production deployment


[0;34m======================================================================
  Test Suite Execution Completed
======================================================================[0m

[0;32m‚úì Consolidated report saved: E_INVOICE_TEST_CONSOLIDATED_REPORT_20251228_203107.txt[0m
====================================================================
E-INVOICE TEST SUITE - CONSOLIDATED REPORT
====================================================================

Execution Date: Sun Dec 28 20:31:07 CST 2025
Project: GMS E-Invoice System
Database: gms_validation
Odoo Version: 19.0
Module: l10n_cr_einvoice

====================================================================
ENVIRONMENT CONFIGURATION
====================================================================

Docker Containers:
- gms_odoo: Up 2 minutes
- gms_postgres: Up 11 minutes

Odoo URL: http://localhost:8070
Database: gms_validation
Test Scripts:
  - Phase 1: test_einvoice_phase1.py
  - Phase 2: test_einvoice_phase2_signature.py
  - Phase 3: test_phase3_api.py

====================================================================
PHASE 1: XML GENERATION TESTS
====================================================================

Status: FAILED/INCOMPLETE

Key Results:
‚úÖ Connected as user ID: 2
‚ö†Ô∏è  Module l10n_cr_einvoice not installed

Generated Files:
  - test_einvoice_10.xml (1.6K)

====================================================================
PHASE 2: DIGITAL SIGNATURE TESTS
====================================================================

Status: Pass Rate:    62.5%

Detailed Results:
‚úÖ PASS: Certificate file exists
‚úÖ Authenticated successfully (UID: 2)
‚úÖ PASS: Upload certificate to company
‚ùå FAIL: Load certificate from .p12
‚úÖ PASS: Wrong PIN error handling
‚úÖ PASS: Create test invoice and e-invoice
‚úÖ PASS: Generate unsigned XML
‚ùå FAIL: Sign XML with certificate
‚ùå FAIL: Complete workflow - XML signing
Passed:       5 ‚úÖ
Failed:       3 ‚ùå
‚úÖ Certificate file exists
‚úÖ Upload certificate to company
‚ùå Load certificate from .p12
‚úÖ Wrong PIN error handling
‚úÖ Create test invoice and e-invoice
‚úÖ Generate unsigned XML
‚ùå Sign XML with certificate
‚ùå Complete workflow - XML signing
‚ùå ATTENTION NEEDED! Multiple tests failed. Review implementation.

Generated Files:
  - phase2_signature_test_results_20251228_202513.json (1.2K)
  - phase2_signature_test_results_20251228_203107.json (1.2K)

====================================================================
PHASE 3: HACIENDA API INTEGRATION TESTS
====================================================================

Status: CONNECTED

Key Results:
‚úÖ Authenticated successfully (UID: 2)
‚ùå Connection failed: HTTP 403
‚ùå No signed documents found to test
‚úÖ ID type detection working

====================================================================
OVERALL ASSESSMENT
====================================================================

Production Readiness:
  - Phase 1 (XML Generation): NOT READY
  - Phase 2 (Digital Signature): NOT READY
  - Phase 3 (Hacienda API): CONNECTED

Critical Issues Found:
      10 total failures detected across all phases

Warnings:
       1 total warnings detected across all phases

====================================================================
RECOMMENDATIONS
====================================================================

1. Review Individual Test Outputs:
   - phase1_test_output.txt for XML generation details
   - phase2_test_output.txt for signature validation details
   - phase3_test_output.txt for API integration details

2. Validate Generated Files:
   - Inspect XML structure against Hacienda v4.4 specification
   - Verify signature structure with external XMLDSig validators
   - Test signed XML submission to Hacienda sandbox

3. Address Failures:
   - Fix any critical failures before production deployment
   - Review warnings for potential issues
   - Re-run tests after fixes

4. Next Steps:
   - If all tests pass: Proceed to production configuration
   - If partial pass: Review and fix failed components
   - If tests fail: Review implementation and configuration

====================================================================
REPORT END - Generated at Sun Dec 28 20:31:07 CST 2025
====================================================================

