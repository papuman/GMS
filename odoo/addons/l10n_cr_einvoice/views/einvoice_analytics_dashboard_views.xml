<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- E-Invoice Analytics Dashboard -->
    <record id="view_einvoice_analytics_dashboard" model="ir.ui.view">
        <field name="name">l10n_cr.einvoice.analytics.dashboard</field>
        <field name="model">l10n_cr.einvoice.analytics.dashboard</field>
        <field name="arch" type="xml">
            <form string="Analytics Dashboard" create="false" edit="false">
                <sheet>
                    <div class="oe_title">
                        <h1>Panel de Análisis - Facturación Electrónica</h1>
                    </div>

                    <group>
                        <group name="filters">
                            <field name="name" invisible="1"/>
                            <label for="date_range" string="Rango de Fechas"/>
                            <div>
                                <button name="filter_last_7_days" string="Últimos 7 días" type="object" class="btn-sm"/>
                                <button name="filter_last_30_days" string="Últimos 30 días" type="object" class="btn-sm"/>
                                <button name="filter_this_month" string="Este mes" type="object" class="btn-sm"/>
                                <button name="filter_last_month" string="Mes pasado" type="object" class="btn-sm"/>
                            </div>
                        </group>
                    </group>

                    <notebook>
                        <page string="Resumen Ejecutivo" name="executive_summary">
                            <group>
                                <group string="Métricas Clave" name="key_metrics">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h6 class="text-muted">Total Facturas</h6>
                                                    <h2 class="dashboard_kpi" id="total_invoices">-</h2>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h6 class="text-muted">Ingresos Totales</h6>
                                                    <h2 class="dashboard_kpi text-success" id="total_revenue">₡0.00</h2>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h6 class="text-muted">Tasa de Aceptación</h6>
                                                    <h2 class="dashboard_kpi text-info" id="acceptance_rate">0%</h2>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h6 class="text-muted">Tiempo Promedio</h6>
                                                    <h2 class="dashboard_kpi" id="avg_processing_time">0 min</h2>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </group>

                                <group string="Estado de Documentos" name="document_status">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>Aceptados:</label>
                                            <span class="text-success dashboard_stat" id="accepted_count">0</span>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Rechazados:</label>
                                            <span class="text-danger dashboard_stat" id="rejected_count">0</span>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Pendientes:</label>
                                            <span class="text-warning dashboard_stat" id="submitted_count">0</span>
                                        </div>
                                    </div>
                                </group>

                                <group string="Por Tipo de Documento" name="document_types">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label>Facturas (FE):</label>
                                            <span class="dashboard_stat" id="fe_count">0</span>
                                            <small class="text-muted" id="fe_revenue"> (₡0.00)</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label>Tiquetes (TE):</label>
                                            <span class="dashboard_stat" id="te_count">0</span>
                                            <small class="text-muted" id="te_revenue"> (₡0.00)</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label>N. Crédito (NC):</label>
                                            <span class="dashboard_stat" id="nc_count">0</span>
                                            <small class="text-muted" id="nc_revenue"> (₡0.00)</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label>N. Débito (ND):</label>
                                            <span class="dashboard_stat" id="nd_count">0</span>
                                            <small class="text-muted" id="nd_revenue"> (₡0.00)</small>
                                        </div>
                                    </div>
                                </group>
                            </group>
                        </page>

                        <page string="Tendencias" name="trends">
                            <group>
                                <div class="row">
                                    <div class="col-12">
                                        <h4>Tendencia de Facturas (Últimos 30 días)</h4>
                                        <div id="invoice_trend_chart" style="height: 400px;"></div>
                                    </div>
                                </div>
                                <div class="row mt32">
                                    <div class="col-12">
                                        <h4>Tendencia de Ingresos</h4>
                                        <div id="revenue_trend_chart" style="height: 400px;"></div>
                                    </div>
                                </div>
                            </group>
                        </page>

                        <page string="Clientes" name="customers">
                            <group string="Top 10 Clientes">
                                <div id="top_customers_table">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </group>
                        </page>

                        <page string="Rendimiento" name="performance">
                            <group>
                                <group string="Email y PDF" name="email_pdf">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Tasa de Entrega Email:</label>
                                            <span class="dashboard_stat" id="email_delivery_rate">0%</span>
                                        </div>
                                        <div class="col-md-6">
                                            <label>Emails Enviados:</label>
                                            <span class="dashboard_stat" id="email_sent_count">0</span>
                                            <span class="text-muted"> / </span>
                                            <span class="dashboard_stat" id="email_eligible_count">0</span>
                                        </div>
                                    </div>
                                </group>

                                <group string="Estado de Colas" name="queue_status">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Cola de Reintentos</h6>
                                            <label>Pendientes:</label>
                                            <span class="dashboard_stat text-warning" id="retry_pending">0</span>
                                            <br/>
                                            <label>Completados:</label>
                                            <span class="dashboard_stat text-success" id="retry_completed">0</span>
                                            <br/>
                                            <label>Fallidos:</label>
                                            <span class="dashboard_stat text-danger" id="retry_failed">0</span>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Cola Offline (POS)</h6>
                                            <label>Pendientes:</label>
                                            <span class="dashboard_stat text-warning" id="offline_pending">0</span>
                                            <br/>
                                            <label>Completados:</label>
                                            <span class="dashboard_stat text-success" id="offline_completed">0</span>
                                            <br/>
                                            <label>Fallidos:</label>
                                            <span class="dashboard_stat text-danger" id="offline_failed">0</span>
                                        </div>
                                    </div>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Dashboard Action -->
    <record id="action_einvoice_analytics_dashboard" model="ir.actions.act_window">
        <field name="name">Panel de Análisis</field>
        <field name="res_model">l10n_cr.einvoice.analytics.dashboard</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
    </record>

    <!-- Menu Item -->
    <menuitem id="menu_einvoice_analytics_dashboard"
              name="Panel de Análisis"
              parent="menu_hacienda_reports"
              action="action_einvoice_analytics_dashboard"
              sequence="10"/>

</odoo>
