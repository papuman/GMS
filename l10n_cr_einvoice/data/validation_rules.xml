<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!--
            Default Validation Rules for Costa Rica E-Invoicing
            These rules enforce Hacienda v4.4 requirements
        -->

        <!-- FE: Customer Required -->
        <record id="validation_rule_fe_customer_required" model="l10n_cr.validation.rule">
            <field name="code">fe_customer_required</field>
            <field name="rule_name">FE: Customer Required</field>
            <field name="sequence">10</field>
            <field name="document_type">FE</field>
            <field name="applies_to">partner</field>
            <field name="field_name">id</field>
            <field name="field_label">Cliente</field>
            <field name="validation_type">required</field>
            <field name="required" eval="True"/>
            <field name="error_message_es">La Factura Electrónica requiere un cliente.

Opciones:
- Seleccione un cliente, o
- Cambie el tipo de documento a Tiquete Electrónico (TE)</field>
            <field name="blocking" eval="True"/>
            <field name="severity">error</field>
            <field name="description">Factura Electrónica requires a customer to be specified. Tiquete Electrónico allows anonymous sales.</field>
        </record>

        <!-- FE: Customer Name Required -->
        <record id="validation_rule_fe_customer_name" model="l10n_cr.validation.rule">
            <field name="code">fe_customer_name_required</field>
            <field name="rule_name">FE: Customer Name Required</field>
            <field name="sequence">20</field>
            <field name="document_type">FE</field>
            <field name="applies_to">partner</field>
            <field name="field_name">name</field>
            <field name="field_label">Nombre del Cliente</field>
            <field name="validation_type">required</field>
            <field name="required" eval="True"/>
            <field name="error_message_es">El nombre del cliente es obligatorio para Factura Electrónica.

Por favor actualice el registro del cliente o cambie a Tiquete (TE).</field>
            <field name="blocking" eval="True"/>
            <field name="severity">error</field>
        </record>

        <!-- FE: Customer VAT Required -->
        <record id="validation_rule_fe_customer_vat" model="l10n_cr.validation.rule">
            <field name="code">fe_customer_vat_required</field>
            <field name="rule_name">FE: Customer VAT/ID Required</field>
            <field name="sequence">30</field>
            <field name="document_type">FE</field>
            <field name="applies_to">partner</field>
            <field name="field_name">vat</field>
            <field name="field_label">Cédula/VAT</field>
            <field name="validation_type">required</field>
            <field name="required" eval="True"/>
            <field name="error_message_es">El número de cédula/identificación es obligatorio para Factura Electrónica.

Por favor actualice el registro del cliente o cambie a Tiquete (TE).</field>
            <field name="blocking" eval="True"/>
            <field name="severity">error</field>
        </record>

        <!-- FE: Customer ID Type - Auto-detected from VAT format -->
        <!-- ID type is determined automatically by xml_generator._get_partner_id_type(vat) -->
        <!-- This rule is kept inactive for reference; no user action needed -->
        <record id="validation_rule_fe_customer_id_type" model="l10n_cr.validation.rule">
            <field name="code">fe_customer_id_type_required</field>
            <field name="rule_name">FE: Customer ID Type (Auto-detected)</field>
            <field name="sequence">40</field>
            <field name="document_type">FE</field>
            <field name="applies_to">partner</field>
            <field name="field_name">vat</field>
            <field name="field_label">Tipo de Identificación</field>
            <field name="validation_type">required</field>
            <field name="required" eval="False"/>
            <field name="error_message_es">El tipo de identificación se determina automáticamente desde el formato de cédula/VAT.

No se requiere acción del usuario.</field>
            <field name="blocking" eval="False"/>
            <field name="severity">info</field>
            <field name="active" eval="False"/>
        </record>

        <!-- FE: Customer Email Required -->
        <record id="validation_rule_fe_customer_email" model="l10n_cr.validation.rule">
            <field name="code">fe_customer_email_required</field>
            <field name="rule_name">FE: Customer Email Required</field>
            <field name="sequence">50</field>
            <field name="document_type">FE</field>
            <field name="applies_to">partner</field>
            <field name="field_name">email</field>
            <field name="field_label">Correo Electrónico</field>
            <field name="validation_type">email</field>
            <field name="required" eval="True"/>
            <field name="error_message_es">El correo electrónico del cliente es obligatorio para Factura Electrónica.

El email es obligatorio según normativa de Hacienda.
Por favor actualice el registro del cliente o cambie a Tiquete (TE).</field>
            <field name="blocking" eval="True"/>
            <field name="severity">error</field>
        </record>

        <!-- FE: Customer CIIU Required (Date-Based: After Oct 6, 2025) -->
        <record id="validation_rule_fe_customer_ciiu" model="l10n_cr.validation.rule">
            <field name="code">fe_customer_ciiu_required</field>
            <field name="rule_name">FE: Customer CIIU Required (after Oct 6, 2025)</field>
            <field name="sequence">60</field>
            <field name="document_type">FE</field>
            <field name="applies_to">partner</field>
            <field name="field_name">l10n_cr_economic_activity_id</field>
            <field name="field_label">Actividad Económica (CIIU)</field>
            <field name="validation_type">required</field>
            <field name="required" eval="True"/>
            <field name="enforcement_date">2025-10-06</field>
            <field name="date_field">invoice_date</field>
            <field name="error_message_es">La actividad económica (CIIU) es obligatoria para Factura Electrónica.

El CIIU es obligatorio desde el 6 de octubre de 2025 según normativa de Hacienda.

Opciones:
1. Agregue el código CIIU al registro del cliente
2. Cambie a Tiquete Electrónico (TE, no requiere CIIU)

¿No está seguro del CIIU? Podemos sugerirle uno según el tipo de cliente.</field>
            <field name="blocking" eval="True"/>
            <field name="severity">error</field>
            <field name="description">CIIU (economic activity code) became mandatory for Receptor on October 6, 2025 per Hacienda regulations.</field>
        </record>

        <!-- Email Format Validation (All Document Types) -->
        <record id="validation_rule_email_format" model="l10n_cr.validation.rule">
            <field name="code">partner_email_format</field>
            <field name="rule_name">Partner: Valid Email Format</field>
            <field name="sequence">100</field>
            <field name="document_type">all</field>
            <field name="applies_to">partner</field>
            <field name="field_name">email</field>
            <field name="field_label">Correo Electrónico</field>
            <field name="validation_type">email</field>
            <field name="required" eval="False"/>
            <field name="error_message_es">El formato del correo electrónico no es válido: {field_value}

El correo debe tener formato: usuario@dominio.com</field>
            <field name="blocking" eval="False"/>
            <field name="severity">warning</field>
        </record>

        <!-- Phone Format Validation -->
        <record id="validation_rule_phone_format" model="l10n_cr.validation.rule">
            <field name="code">partner_phone_format</field>
            <field name="rule_name">Partner: Valid Phone Format (Costa Rica)</field>
            <field name="sequence">110</field>
            <field name="document_type">all</field>
            <field name="applies_to">partner</field>
            <field name="field_name">phone</field>
            <field name="field_label">Teléfono</field>
            <field name="validation_type">phone</field>
            <field name="required" eval="False"/>
            <field name="error_message_es">El formato del teléfono no es válido: {field_value}

Los números de Costa Rica deben tener 8 dígitos.</field>
            <field name="blocking" eval="False"/>
            <field name="severity">warning</field>
        </record>

        <!-- VAT Length Validation (9 digits for Cédula Física) -->
        <record id="validation_rule_vat_cedula_fisica" model="l10n_cr.validation.rule">
            <field name="code">vat_cedula_fisica_format</field>
            <field name="rule_name">VAT: Cédula Física Format (9 digits)</field>
            <field name="sequence">120</field>
            <field name="document_type">all</field>
            <field name="applies_to">partner</field>
            <field name="field_name">vat</field>
            <field name="field_label">Cédula Física</field>
            <field name="validation_type">regex</field>
            <field name="validation_params">{"pattern": "^[0-9]{9}$"}</field>
            <field name="required" eval="False"/>
            <field name="error_message_es">La Cédula Física debe tener exactamente 9 dígitos.

Valor actual: {field_value}</field>
            <field name="blocking" eval="False"/>
            <field name="severity">warning</field>
            <field name="description">This rule validates format only. ID type-specific validation happens in res.partner constraints.</field>
        </record>

        <!-- Company Certificate Validation -->
        <!-- Certificate validation is handled by xml_generator._validate_company_certificate() -->
        <!-- which checks the correct fields (l10n_cr_certificate / l10n_cr_prod_certificate) -->
        <!-- This rule is deactivated to avoid duplicate/phantom field checks -->
        <record id="validation_rule_company_certificate" model="l10n_cr.validation.rule">
            <field name="code">company_certificate_valid</field>
            <field name="rule_name">Company: Valid Signing Certificate (handled by xml_generator)</field>
            <field name="sequence">200</field>
            <field name="document_type">all</field>
            <field name="applies_to">company</field>
            <field name="field_name">l10n_cr_certificate_filename</field>
            <field name="field_label">Certificado de Firma</field>
            <field name="validation_type">required</field>
            <field name="required" eval="False"/>
            <field name="error_message_es">La validación del certificado se realiza durante la generación del XML.</field>
            <field name="blocking" eval="False"/>
            <field name="severity">info</field>
            <field name="active" eval="False"/>
            <field name="description">Certificate validation is handled by xml_generator._validate_company_certificate() which checks the correct environment-specific fields.</field>
        </record>

        <!-- Document Amount Validation -->
        <record id="validation_rule_document_amount" model="l10n_cr.validation.rule">
            <field name="code">document_amount_positive</field>
            <field name="rule_name">Document: Amount Must Be Positive</field>
            <field name="sequence">300</field>
            <field name="document_type">all</field>
            <field name="applies_to">document</field>
            <field name="field_name">amount_total</field>
            <field name="field_label">Total Amount</field>
            <field name="validation_type">range</field>
            <field name="validation_params">{"min": 0.01}</field>
            <field name="required" eval="True"/>
            <field name="error_message_es">El monto total del documento debe ser mayor a cero.

Valor actual: {field_value}</field>
            <field name="blocking" eval="True"/>
            <field name="severity">error</field>
        </record>

    </data>
</odoo>
