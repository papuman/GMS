
================================================================================
  Phase 2 E-Invoice Digital Signature Testing
================================================================================

This script tests the following components:
  • Certificate Manager (certificate_manager.py)
  • XML Signer (xml_signer.py)
  • Digital Signature Workflow
  • XMLDSig Structure Validation

--------------------------------------------------------------------------------
  Test 1: Certificate File Verification
--------------------------------------------------------------------------------

✅ PASS: Certificate file exists
    Found at /Users/javycarrillo/Library/CloudStorage/Dropbox/AI/Apps/GMS/docs/Tribu-CR/certificado.p12 (6,852 bytes)

--------------------------------------------------------------------------------
  Odoo Connection
--------------------------------------------------------------------------------

Connecting to Odoo...
Authenticating as admin...
✅ Authenticated successfully (UID: 2)

--------------------------------------------------------------------------------
  Test 2: Certificate Upload to Company
--------------------------------------------------------------------------------

✅ PASS: Upload certificate to company
    Certificate uploaded to company ID 1

--------------------------------------------------------------------------------
  Test 3: Certificate Loading (.p12)
--------------------------------------------------------------------------------

❌ FAIL: Load certificate from .p12
    Error: 'int' object has no attribute 'l10n_cr_certificate'

--------------------------------------------------------------------------------
  Test 5: Error Handling - Wrong PIN
--------------------------------------------------------------------------------

✅ PASS: Wrong PIN error handling
    Correctly rejected wrong PIN

--------------------------------------------------------------------------------
  Test 10: Complete Workflow Integration
--------------------------------------------------------------------------------


--------------------------------------------------------------------------------
  Test 6: Create Test Invoice for Signing
--------------------------------------------------------------------------------

✅ PASS: Create test invoice and e-invoice
    Invoice INV/2025/00022, E-Invoice ID 13

--------------------------------------------------------------------------------
  Test 7: XML Generation (Pre-Signing)
--------------------------------------------------------------------------------

✅ PASS: Generate unsigned XML
    Generated 2,255 bytes

--------------------------------------------------------------------------------
  Test 8: XML Digital Signature
--------------------------------------------------------------------------------

❌ FAIL: Sign XML with certificate
    Error: <Fault 2: 'Error signing XML: Company certificate and private key must be configured.'>
❌ FAIL: Complete workflow - XML signing
    Signing failed

================================================================================
  Phase 2 Test Summary
================================================================================

Total Tests:  8
Passed:       5 ✅
Failed:       3 ❌
Pass Rate:    62.5%

--------------------------------------------------------------------------------
Detailed Results:
--------------------------------------------------------------------------------

✅ Certificate file exists
    Found at /Users/javycarrillo/Library/CloudStorage/Dropbox/AI/Apps/GMS/docs/Tribu-CR/certificado.p12 (6,852 bytes)
✅ Upload certificate to company
    Certificate uploaded to company ID 1
❌ Load certificate from .p12
    Error: 'int' object has no attribute 'l10n_cr_certificate'
✅ Wrong PIN error handling
    Correctly rejected wrong PIN
✅ Create test invoice and e-invoice
    Invoice INV/2025/00022, E-Invoice ID 13
✅ Generate unsigned XML
    Generated 2,255 bytes
❌ Sign XML with certificate
    Error: <Fault 2: 'Error signing XML: Company certificate and private key must be configured.'>
❌ Complete workflow - XML signing
    Signing failed

================================================================================

❌ ATTENTION NEEDED! Multiple tests failed. Review implementation.

================================================================================

Results saved to: phase2_signature_test_results_20251228_204711.json
================================================================================


Next Steps:
1. Review generated signed_xml_*.xml files
2. Verify signature structure matches Hacienda requirements
3. Ready to start Phase 3: Hacienda API Integration

================================================================================

